/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/documentation/sdk/controller/MasterTreeBaseController","sap/ui/documentation/sdk/model/formatter","sap/m/library","sap/base/Log","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(D,M,f,m,L,F,a){"use strict";var S=m.SplitAppMode;return M.extend("sap.ui.documentation.sdk.controller.ApiMaster",{formatter:f,onInit:function(){this._bIncludeDeprecated=false;var c=this.getOwnerComponent();c.loadVersionInfo().then(c.fetchAPIIndex.bind(c)).then(function(){this._expandTreeToNode(this._topicId,this.getOwnerComponent().getModel("treeData"));}.bind(this));this._initTreeUtil("name","nodes");this.getRouter().getRoute("api").attachPatternMatched(this._onMatched,this);this.getRouter().getRoute("apiId").attachPatternMatched(this._onTopicMatched,this);this.getRouter().getRoute("deprecated").attachPatternMatched(this._onTopicMatched,this);this.getRouter().getRoute("experimental").attachPatternMatched(this._onTopicMatched,this);this.getRouter().getRoute("since").attachPatternMatched(this._onTopicMatched,this);},onBeforeRendering:function(){this.buildAndApplyFilters();},selectDeprecatedSymbol:function(t){this._bIncludeDeprecated=true;this.byId("includeDeprecated").setSelected(true);this.buildAndApplyFilters();this._expandTreeToNode(t,this.getModel("treeData"));},_onTopicMatched:function(b){try{this.showMasterSide();}catch(e){L.error(e);}this._topicId=f.decodeModuleName(b.getParameter("arguments").id)||b.getParameter("name");this._expandTreeToNode(this._topicId,this.getOwnerComponent().getModel("treeData"));},_onMatched:function(){var s=this.getView().getParent().getParent(),b=this.byId('tree'),c;s.setMode(S.ShowHideMode);if(b){c=b.getSelectedItem();c&&c.setSelected(false);}if(D.system.desktop){setTimeout(function(){this.getView().byId("searchField").getFocusDomRef().focus();}.bind(this),0);}},compareTreeNodes:function(n,N){if(n==="EXPERIMENTAL"){return 1;}if(N==="EXPERIMENTAL"){return-1;}if(n==="DEPRECATED"){return 1;}if(N==="DEPRECATED"){return-1;}if(n<N){return-1;}if(n>N){return 1;}if(n===N){return 0;}},onNodeSelect:function(e){var n=e.getParameter("listItem");var b=n.getCustomData()[0].getValue();if(!b){L.warning("Missing name for entity: "+n.getId()+" - cannot navigate to API ref");return;}this.getRouter().navTo("apiId",{id:f.encodeModuleName(b)},false);},buildAndApplyFilters:function(){var b=[];if(!this._bIncludeDeprecated){b.push(new F({path:"bIsDeprecated",operator:a.EQ,value1:false}));}if(this._sFilter){b.push(new F({and:false,filters:[new F({path:"name",operator:a.Contains,value1:this._sFilter}),new F({path:"name",operator:a.Contains,value1:this._sFilter.replace(/\s/g,'')})]}));}this.byId("tree").getBinding("items").filter(new F({and:true,filters:b}));return!!this._sFilter;},onIncludeDeprecatedItemsChange:function(e){this._bIncludeDeprecated=e.getParameter("selected");this.buildAndApplyFilters();}});});
